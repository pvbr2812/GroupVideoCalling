{"ast":null,"code":"\"use strict\";\n/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ContextAPI = void 0;\n\nvar context_base_1 = require(\"@opentelemetry/context-base\");\n\nvar global_utils_1 = require(\"./global-utils\");\n\nvar NOOP_CONTEXT_MANAGER = new context_base_1.NoopContextManager();\n/**\n * Singleton object which represents the entry point to the OpenTelemetry Context API\n */\n\nvar ContextAPI =\n/** @class */\nfunction () {\n  /** Empty private constructor prevents end users from constructing a new instance of the API */\n  function ContextAPI() {}\n  /** Get the singleton instance of the Context API */\n\n\n  ContextAPI.getInstance = function () {\n    if (!this._instance) {\n      this._instance = new ContextAPI();\n    }\n\n    return this._instance;\n  };\n  /**\n   * Set the current context manager. Returns the initialized context manager\n   */\n\n\n  ContextAPI.prototype.setGlobalContextManager = function (contextManager) {\n    if (global_utils_1._global[global_utils_1.GLOBAL_CONTEXT_MANAGER_API_KEY]) {\n      // global context manager has already been set\n      return this._getContextManager();\n    }\n\n    global_utils_1._global[global_utils_1.GLOBAL_CONTEXT_MANAGER_API_KEY] = global_utils_1.makeGetter(global_utils_1.API_BACKWARDS_COMPATIBILITY_VERSION, contextManager, NOOP_CONTEXT_MANAGER);\n    return contextManager;\n  };\n  /**\n   * Get the currently active context\n   */\n\n\n  ContextAPI.prototype.active = function () {\n    return this._getContextManager().active();\n  };\n  /**\n   * Execute a function with an active context\n   *\n   * @param context context to be active during function execution\n   * @param fn function to execute in a context\n   */\n\n\n  ContextAPI.prototype.with = function (context, fn) {\n    return this._getContextManager().with(context, fn);\n  };\n  /**\n   * Bind a context to a target function or event emitter\n   *\n   * @param target function or event emitter to bind\n   * @param context context to bind to the event emitter or function. Defaults to the currently active context\n   */\n\n\n  ContextAPI.prototype.bind = function (target, context) {\n    if (context === void 0) {\n      context = this.active();\n    }\n\n    return this._getContextManager().bind(target, context);\n  };\n\n  ContextAPI.prototype._getContextManager = function () {\n    var _a, _b;\n\n    return (_b = (_a = global_utils_1._global[global_utils_1.GLOBAL_CONTEXT_MANAGER_API_KEY]) === null || _a === void 0 ? void 0 : _a.call(global_utils_1._global, global_utils_1.API_BACKWARDS_COMPATIBILITY_VERSION)) !== null && _b !== void 0 ? _b : NOOP_CONTEXT_MANAGER;\n  };\n  /** Disable and remove the global context manager */\n\n\n  ContextAPI.prototype.disable = function () {\n    this._getContextManager().disable();\n\n    delete global_utils_1._global[global_utils_1.GLOBAL_CONTEXT_MANAGER_API_KEY];\n  };\n\n  return ContextAPI;\n}();\n\nexports.ContextAPI = ContextAPI;","map":{"version":3,"sources":["../../../src/api/context.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;AAcG;;;;;;;AAEH,IAAA,cAAA,GAAA,OAAA,CAAA,6BAAA,CAAA;;AAKA,IAAA,cAAA,GAAA,OAAA,CAAA,gBAAA,CAAA;;AAOA,IAAM,oBAAoB,GAAG,IAAI,cAAA,CAAA,kBAAJ,EAA7B;AAEA;;AAEG;;AACH,IAAA,UAAA;AAAA;AAAA,YAAA;AAGE;AACA,WAAA,UAAA,GAAA,CAAwB;AAExB;;;AACc,EAAA,UAAA,CAAA,WAAA,GAAd,YAAA;AACE,QAAI,CAAC,KAAK,SAAV,EAAqB;AACnB,WAAK,SAAL,GAAiB,IAAI,UAAJ,EAAjB;AACD;;AAED,WAAO,KAAK,SAAZ;AACD,GANa;AAQd;;AAEG;;;AACI,EAAA,UAAA,CAAA,SAAA,CAAA,uBAAA,GAAP,UACE,cADF,EACgC;AAE9B,QAAI,cAAA,CAAA,OAAA,CAAQ,cAAA,CAAA,8BAAR,CAAJ,EAA6C;AAC3C;AACA,aAAO,KAAK,kBAAL,EAAP;AACD;;AAED,IAAA,cAAA,CAAA,OAAA,CAAQ,cAAA,CAAA,8BAAR,IAA0C,cAAA,CAAA,UAAA,CACxC,cAAA,CAAA,mCADwC,EAExC,cAFwC,EAGxC,oBAHwC,CAA1C;AAMA,WAAO,cAAP;AACD,GAfM;AAiBP;;AAEG;;;AACI,EAAA,UAAA,CAAA,SAAA,CAAA,MAAA,GAAP,YAAA;AACE,WAAO,KAAK,kBAAL,GAA0B,MAA1B,EAAP;AACD,GAFM;AAIP;;;;;AAKG;;;AACI,EAAA,UAAA,CAAA,SAAA,CAAA,IAAA,GAAP,UACE,OADF,EAEE,EAFF,EAEO;AAEL,WAAO,KAAK,kBAAL,GAA0B,IAA1B,CAA+B,OAA/B,EAAwC,EAAxC,CAAP;AACD,GALM;AAOP;;;;;AAKG;;;AACI,EAAA,UAAA,CAAA,SAAA,CAAA,IAAA,GAAP,UAAe,MAAf,EAA0B,OAA1B,EAA0D;AAAhC,QAAA,OAAA,KAAA,KAAA,CAAA,EAAA;AAAA,MAAA,OAAA,GAAmB,KAAK,MAAL,EAAnB;AAAgC;;AACxD,WAAO,KAAK,kBAAL,GAA0B,IAA1B,CAA+B,MAA/B,EAAuC,OAAvC,CAAP;AACD,GAFM;;AAIC,EAAA,UAAA,CAAA,SAAA,CAAA,kBAAA,GAAR,YAAA;;;AACE,WAAO,CAAA,EAAA,GAAA,CAAA,EAAA,GACL,cAAA,CAAA,OAAA,CAAQ,cAAA,CAAA,8BAAR,CADK,MACkC,IADlC,IACkC,EAAA,KAAA,KAAA,CADlC,GACkC,KAAA,CADlC,GACkC,EAAA,CAAA,IAAA,CAAvC,cAAA,CAAA,OAAuC,EACrC,cAAA,CAAA,mCADqC,CADlC,MAEgC,IAFhC,IAEgC,EAAA,KAAA,KAAA,CAFhC,GAEgC,EAFhC,GAGA,oBAHP;AAKD,GANO;AAQR;;;AACO,EAAA,UAAA,CAAA,SAAA,CAAA,OAAA,GAAP,YAAA;AACE,SAAK,kBAAL,GAA0B,OAA1B;;AACA,WAAO,cAAA,CAAA,OAAA,CAAQ,cAAA,CAAA,8BAAR,CAAP;AACD,GAHM;;AAIT,SAAA,UAAA;AAAC,CA9ED,EAAA;;AAAa,OAAA,CAAA,UAAA,GAAA,UAAA","sourceRoot":"","sourcesContent":["\"use strict\";\n/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ContextAPI = void 0;\nvar context_base_1 = require(\"@opentelemetry/context-base\");\nvar global_utils_1 = require(\"./global-utils\");\nvar NOOP_CONTEXT_MANAGER = new context_base_1.NoopContextManager();\n/**\n * Singleton object which represents the entry point to the OpenTelemetry Context API\n */\nvar ContextAPI = /** @class */ (function () {\n    /** Empty private constructor prevents end users from constructing a new instance of the API */\n    function ContextAPI() {\n    }\n    /** Get the singleton instance of the Context API */\n    ContextAPI.getInstance = function () {\n        if (!this._instance) {\n            this._instance = new ContextAPI();\n        }\n        return this._instance;\n    };\n    /**\n     * Set the current context manager. Returns the initialized context manager\n     */\n    ContextAPI.prototype.setGlobalContextManager = function (contextManager) {\n        if (global_utils_1._global[global_utils_1.GLOBAL_CONTEXT_MANAGER_API_KEY]) {\n            // global context manager has already been set\n            return this._getContextManager();\n        }\n        global_utils_1._global[global_utils_1.GLOBAL_CONTEXT_MANAGER_API_KEY] = global_utils_1.makeGetter(global_utils_1.API_BACKWARDS_COMPATIBILITY_VERSION, contextManager, NOOP_CONTEXT_MANAGER);\n        return contextManager;\n    };\n    /**\n     * Get the currently active context\n     */\n    ContextAPI.prototype.active = function () {\n        return this._getContextManager().active();\n    };\n    /**\n     * Execute a function with an active context\n     *\n     * @param context context to be active during function execution\n     * @param fn function to execute in a context\n     */\n    ContextAPI.prototype.with = function (context, fn) {\n        return this._getContextManager().with(context, fn);\n    };\n    /**\n     * Bind a context to a target function or event emitter\n     *\n     * @param target function or event emitter to bind\n     * @param context context to bind to the event emitter or function. Defaults to the currently active context\n     */\n    ContextAPI.prototype.bind = function (target, context) {\n        if (context === void 0) { context = this.active(); }\n        return this._getContextManager().bind(target, context);\n    };\n    ContextAPI.prototype._getContextManager = function () {\n        var _a, _b;\n        return ((_b = (_a = global_utils_1._global[global_utils_1.GLOBAL_CONTEXT_MANAGER_API_KEY]) === null || _a === void 0 ? void 0 : _a.call(global_utils_1._global, global_utils_1.API_BACKWARDS_COMPATIBILITY_VERSION)) !== null && _b !== void 0 ? _b : NOOP_CONTEXT_MANAGER);\n    };\n    /** Disable and remove the global context manager */\n    ContextAPI.prototype.disable = function () {\n        this._getContextManager().disable();\n        delete global_utils_1._global[global_utils_1.GLOBAL_CONTEXT_MANAGER_API_KEY];\n    };\n    return ContextAPI;\n}());\nexports.ContextAPI = ContextAPI;\n//# sourceMappingURL=context.js.map"]},"metadata":{},"sourceType":"script"}